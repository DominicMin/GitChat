# GitChat æŠ€æœ¯æ¶æ„æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-28  
> **ç»´æŠ¤è€…**: GitChat Team

---

## ğŸ“š ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [Content Graph å­˜å‚¨æœºåˆ¶](#content-graph-å­˜å‚¨æœºåˆ¶)
3. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
4. [æ•°æ®æµ](#æ•°æ®æµ)
5. [API è®¾è®¡](#api-è®¾è®¡)
6. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (React)                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ NodeChat.js  â”‚  â”‚ UserInput    â”‚  â”‚ LLMResponse  â”‚   â”‚
â”‚  â”‚ (Main App)   â”‚  â”‚ Node         â”‚  â”‚ Node         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                               â”‚
â”‚         â”‚ Uses ReactFlow                                â”‚
â”‚         â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        Content Graph (In-Memory State)          â”‚    â”‚
â”‚  â”‚  - nodes: Node[]    (useNodesState)             â”‚    â”‚
â”‚  â”‚  - edges: Edge[]    (useEdgesState)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”˜
                        â”‚ HTTP/SSE
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend (Node.js + Express)             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ server.js    â”‚  â”‚ OpenAI SDK   â”‚  â”‚ System       â”‚  â”‚
â”‚  â”‚              â”‚â†’ â”‚              â”‚â†’ â”‚ Prompt       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTPS
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLM API (OpenAI Compatible)                 â”‚
â”‚  - OpenAI API                                            â”‚
â”‚  - Azure OpenAI                                          â”‚
â”‚  - OpenRouter                                            â”‚
â”‚  - Local LLMs (Ollama, LM Studio)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Content Graph å­˜å‚¨æœºåˆ¶

### æ ¸å¿ƒæ•°æ®ç»“æ„

GitChat ä½¿ç”¨ **ReactFlow** ç®¡ç† Content Graphï¼Œæ•°æ®å®Œå…¨å­˜å‚¨åœ¨**å‰ç«¯å†…å­˜**ä¸­ï¼ˆReact Stateï¼‰ã€‚

#### 1. Node æ•°æ®ç»“æ„

```typescript
interface Node {
  id: string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼: "userInput-{timestamp}" æˆ– "llmResponse-{timestamp}"
  type: 'userInput' | 'llmResponse';  // èŠ‚ç‚¹ç±»å‹
  position: {                    // ç”»å¸ƒä¸Šçš„ä½ç½®åæ ‡
    x: number;
    y: number;
  };
  data: {                        // èŠ‚ç‚¹å†…å®¹
    text: string;                // æ¶ˆæ¯å†…å®¹
  };
  selected?: boolean;            // æ˜¯å¦è¢«é€‰ä¸­
}
```

**å®é™…ç¤ºä¾‹**ï¼š
```javascript
{
  id: "userInput-1698765432000",
  type: "userInput",
  position: { x: 100, y: 200 },
  data: { text: "å¦‚ä½•å®ç°ç™»å½•åŠŸèƒ½ï¼Ÿ" },
  selected: false
}
```

#### 2. Edge æ•°æ®ç»“æ„

```typescript
interface Edge {
  id: string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼: "e{sourceId}-{targetId}-{timestamp}"
  source: string;                // æºèŠ‚ç‚¹ ID
  target: string;                // ç›®æ ‡èŠ‚ç‚¹ ID
  type: 'custom';                // è¾¹çš„ç±»å‹ï¼ˆä½¿ç”¨è‡ªå®šä¹‰è¾¹ç»„ä»¶ï¼‰
  data: {
    onEdgeClick: (edgeId: string) => void;  // ç‚¹å‡»è¾¹çš„å›è°ƒå‡½æ•°
  };
}
```

**å®é™…ç¤ºä¾‹**ï¼š
```javascript
{
  id: "euserInput-1698765432000-llmResponse-1698765435000-1698765435100",
  source: "userInput-1698765432000",
  target: "llmResponse-1698765435000",
  type: "custom",
  data: {
    onEdgeClick: (edgeId) => { /* åˆ é™¤è¾¹çš„é€»è¾‘ */ }
  }
}
```

### å­˜å‚¨å®ç°

#### 1. React State ç®¡ç†

```javascript
// åœ¨ NodeChat.js ä¸­
const [nodes, setNodes, onNodesChange] = useNodesState([]);
const [edges, setEdges, onEdgesChange] = useEdgesState([]);
```

**ç‰¹ç‚¹**ï¼š
- âœ… **å®æ—¶å“åº”**ï¼šçŠ¶æ€å˜åŒ–ç«‹å³åæ˜ åˆ° UI
- âœ… **é«˜æ€§èƒ½**ï¼šçº¯å†…å­˜æ“ä½œï¼Œæ—  I/O å»¶è¿Ÿ
- âŒ **æ˜“å¤±æ€§**ï¼šåˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±
- âŒ **æ— æŒä¹…åŒ–**ï¼šå½“å‰ç‰ˆæœ¬ä¸æ”¯æŒä¿å­˜

#### 2. Graph å…³ç³»ç»´æŠ¤

**çˆ¶å­å…³ç³»**é€šè¿‡ edges éšå¼è¡¨ç¤ºï¼š
```javascript
// æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹ï¼ˆincomersï¼‰
const incomers = getIncomers({ id: nodeId }, nodes, edges);

// æŸ¥æ‰¾å­èŠ‚ç‚¹ï¼ˆoutgoersï¼‰
const outgoers = getOutgoers({ id: nodeId }, nodes, edges);
```

**åˆ†æ”¯å’Œåˆå¹¶**ï¼š
- **åˆ†æ”¯**ï¼šä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ª outgoersï¼ˆå¤šæ¡è¾¹æŒ‡å‘ä¸åŒèŠ‚ç‚¹ï¼‰
- **åˆå¹¶**ï¼šä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ª incomersï¼ˆå¤šæ¡è¾¹æ¥è‡ªä¸åŒèŠ‚ç‚¹ï¼‰

```
         â”Œâ”€â†’ Node B (åˆ†æ”¯1)
Node A â”€â”€â”¤
         â””â”€â†’ Node C (åˆ†æ”¯2)

Node D â”€â”€â”
         â”œâ”€â†’ Node F (åˆå¹¶)
Node E â”€â”€â”˜
```

#### 3. ä¸Šä¸‹æ–‡æ ‘æ„å»º

ä»å½“å‰èŠ‚ç‚¹å‘ä¸Šé€’å½’æŸ¥æ‰¾æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼š

```javascript
// Utility.js ä¸­çš„æ ¸å¿ƒå‡½æ•°
export function getConversationHistory(node, nodes, edges) {
  const history = [];
  const nodeMap = new Map(nodes.map(n => [n.id, n]));

  function processNode(currentNode) {
    if (!currentNode) return;

    const nodeHistory = {
      id: currentNode.id,
      role: currentNode.type === 'userInput' ? 'user' : 'assistant',
      parent: [],
      content: currentNode.data.text,
      children: []
    };

    // æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹
    const incomers = getIncomers({ id: currentNode.id }, nodes, edges);
    nodeHistory.parent = incomers.map(incomer => incomer.id);

    // æŸ¥æ‰¾å­èŠ‚ç‚¹ï¼ˆå½“å‰èŠ‚ç‚¹é™¤å¤–ï¼‰
    if (node.id !== currentNode.id) {
      const outgoers = getOutgoers({ id: currentNode.id }, nodes, edges);
      nodeHistory.children = outgoers.map(outgoer => outgoer.id);
    }
    
    history.unshift(nodeHistory);

    // é€’å½’å¤„ç†çˆ¶èŠ‚ç‚¹
    incomers.forEach(incomer => processNode(nodeMap.get(incomer.id)));
  }

  processNode(node);
  return history;
}
```

**è¾“å‡ºæ ¼å¼**ï¼ˆå‘é€ç»™ LLMï¼‰ï¼š
```json
[
  {
    "id": "userInput-1698765432000",
    "role": "user",
    "parent": [],
    "content": "å¦‚ä½•å®ç°ç™»å½•ï¼Ÿ",
    "children": ["llmResponse-1698765435000"]
  },
  {
    "id": "llmResponse-1698765435000",
    "role": "assistant",
    "parent": ["userInput-1698765432000"],
    "content": "å¯ä»¥ä½¿ç”¨ JWT...",
    "children": []
  }
]
```

### å†…å­˜å ç”¨ä¼°ç®—

å‡è®¾ä¸€ä¸ªå…¸å‹çš„å¯¹è¯æ ‘ï¼š
- 100 ä¸ªèŠ‚ç‚¹
- å¹³å‡æ¯ä¸ªèŠ‚ç‚¹ 500 å­—ç¬¦
- 150 æ¡è¾¹

**è®¡ç®—**ï¼š
```
Nodes: 100 Ã— (100 bytes metadata + 500 bytes text) = 60 KB
Edges: 150 Ã— 200 bytes = 30 KB
æ€»è®¡: ~90 KB
```

**ç»“è®º**ï¼šå³ä½¿æ˜¯å¤§å‹å¯¹è¯æ ‘ï¼ˆ1000+ èŠ‚ç‚¹ï¼‰ï¼Œå†…å­˜å ç”¨ä¹Ÿä»…åœ¨ 1MB çº§åˆ«ï¼Œå®Œå…¨å¯ä»¥æ¥å—ã€‚

---

## ğŸ§© æ ¸å¿ƒæ¨¡å—

### 1. NodeChat ç»„ä»¶ (ä¸»åº”ç”¨)

**æ–‡ä»¶**: `nodechat/src/components/NodeChat.js`

**èŒè´£**ï¼š
- ç®¡ç†æ•´ä¸ªå¯¹è¯å›¾çš„çŠ¶æ€ï¼ˆnodes + edgesï¼‰
- å¤„ç†ç”¨æˆ·äº¤äº’ï¼ˆæ·»åŠ èŠ‚ç‚¹ã€è¿æ¥ã€å³é”®èœå•ï¼‰
- åè°ƒå­ç»„ä»¶ï¼ˆUserInputNodeã€LLMResponseNodeï¼‰
- ä¸åç«¯é€šä¿¡

**å…³é”®æ–¹æ³•**ï¼š

```javascript
// æ·»åŠ æ–°èŠ‚ç‚¹
const addNode = useCallback((type, sourceNode, offset, text, connectToSource) => {
  // è®¡ç®—æ–°èŠ‚ç‚¹ä½ç½®
  // åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡
  // æ›´æ–° nodes state
  // å¦‚æœéœ€è¦ï¼Œåˆ›å»ºè¿æ¥è¾¹
});

// å¤„ç†æ¶ˆæ¯å‘é€
const handleSendMessage = useCallback(async () => {
  // 1. åˆ›å»ºç”¨æˆ·è¾“å…¥èŠ‚ç‚¹
  // 2. åˆ›å»º LLM å“åº”èŠ‚ç‚¹ï¼ˆç©ºå†…å®¹ï¼‰
  // 3. è·å–ä¸Šä¸‹æ–‡å†å²
  // 4. å‘é€è¯·æ±‚åˆ°åç«¯
  // 5. æµå¼æ¥æ”¶å“åº”å¹¶æ›´æ–°èŠ‚ç‚¹
});

// å¤åˆ¶èŠ‚ç‚¹
const handleReplicate = useCallback(({ props }) => {
  // å¤åˆ¶èŠ‚ç‚¹å†…å®¹å’Œä½ç½®
  // å¤åˆ¶ä¸Šæ¸¸è¿æ¥
});
```

### 2. UserInputNode ç»„ä»¶

**æ–‡ä»¶**: `nodechat/src/components/UserInputNode.js`

**èŒè´£**ï¼š
- æ¸²æŸ“ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹
- æ”¯æŒåŒå‡»ç¼–è¾‘
- æŠ˜å /å±•å¼€é•¿æ–‡æœ¬
- è§¦å‘å“åº”é‡æ–°ç”Ÿæˆ

**ç‰¹æ€§**ï¼š
- **å®æ—¶è°ƒæ•´å¤§å°**ï¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹å°ºå¯¸
- **çº§è”é‡æ–°ç”Ÿæˆ**ï¼šä¿®æ”¹è¾“å…¥åè‡ªåŠ¨é‡æ–°ç”Ÿæˆæ‰€æœ‰åä»£å“åº”
- **è¿æ¥ç‚¹**ï¼šé¡¶éƒ¨ï¼ˆtargetï¼‰å’Œåº•éƒ¨ï¼ˆsourceï¼‰

```javascript
// çº§è”é‡æ–°ç”Ÿæˆ
const onRegenerate = useCallback(async () => {
  // 1. è·å–æ‰€æœ‰åä»£èŠ‚ç‚¹
  const descendants = findAllDescendants(userNode.id, nodes, edges);
  
  // 2. å¯¹æ¯ä¸ª LLM å“åº”èŠ‚ç‚¹é‡æ–°ç”Ÿæˆ
  for (const descendantId of descendants) {
    if (descendantNode.type === 'llmResponse') {
      await regenerateNode(descendantNode);
    }
  }
});
```

### 3. LLMResponseNode ç»„ä»¶

**æ–‡ä»¶**: `nodechat/src/components/LLMResponseNode.js`

**èŒè´£**ï¼š
- æ¸²æŸ“ LLM å“åº”èŠ‚ç‚¹
- Markdown æ ¼å¼åŒ–æ˜¾ç¤º
- ä»£ç è¯­æ³•é«˜äº®
- æ”¯æŒç¼–è¾‘å’ŒæŠ˜å 

**ç‰¹æ€§**ï¼š
- **Markdown æ¸²æŸ“**ï¼šä½¿ç”¨ `react-markdown` + `remark-gfm`
- **ä»£ç é«˜äº®**ï¼šä½¿ç”¨ `react-syntax-highlighter`
- **æµå¼æ›´æ–°**ï¼šå“åº”ç”Ÿæˆæ—¶å®æ—¶æ›´æ–°æ˜¾ç¤º

```javascript
<ReactMarkdown
  remarkPlugins={[remarkGfm]}
  components={{
    code({ inline, className, children }) {
      // ä»£ç å—é«˜äº®æ¸²æŸ“
    }
  }}
>
  {text}
</ReactMarkdown>
```

### 4. CustomEdge ç»„ä»¶

**æ–‡ä»¶**: `nodechat/src/components/CustomEdge.js`

**èŒè´£**ï¼š
- æ¸²æŸ“è¿æ¥è¾¹ï¼ˆè´å¡å°”æ›²çº¿ï¼‰
- å¤„ç†è¾¹çš„ç‚¹å‡»åˆ é™¤

**å®ç°**ï¼š
```javascript
// ä½¿ç”¨ ReactFlow çš„ getBezierPath ç”Ÿæˆæ›²çº¿è·¯å¾„
const edgePath = getBezierPath({
  sourceX, sourceY, sourcePosition,
  targetX, targetY, targetPosition,
});

// ä¸¤å±‚è·¯å¾„ï¼š
// 1. å¯è§è·¯å¾„ï¼ˆæ˜¾ç¤ºè¿æ¥çº¿ï¼‰
// 2. é€æ˜è·¯å¾„ï¼ˆæ‰©å¤§ç‚¹å‡»åŒºåŸŸï¼‰
```

### 5. Utility æ¨¡å—

**æ–‡ä»¶**: `nodechat/src/components/Utility.js`

**èŒè´£**ï¼š
- ä¸Šä¸‹æ–‡å†å²æ„å»º
- ç½‘ç»œè¯·æ±‚å°è£…
- æ ‘éå†è¾…åŠ©å‡½æ•°

**æ ¸å¿ƒå‡½æ•°**ï¼š

```javascript
// 1. å‘é€è¯·æ±‚ï¼ˆæ”¯æŒæµå¼å“åº”ï¼‰
export async function sendConversationRequest(endpoint, conversation, onChunkReceived) {
  // Server-Sent Events (SSE) æµå¼æ¥æ”¶
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  
  while (!done) {
    const { value, done: readerDone } = await reader.read();
    // è§£æ SSE æ•°æ®æ ¼å¼: "data: {...}\n\n"
    // è§¦å‘ onChunkReceived å›è°ƒ
  }
}

// 2. æŸ¥æ‰¾æ‰€æœ‰åä»£
export function findAllDescendants(nodeId, nodes, edges) {
  // é€’å½’æŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹å’Œå­å­™èŠ‚ç‚¹
}

// 3. æŸ¥æ‰¾æ‰€æœ‰ç¥–å…ˆ
export function findAllPrecedents(nodeId, nodes, edges) {
  // é€’å½’æŸ¥æ‰¾æ‰€æœ‰çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹
}

// 4. æ„å»ºå¯¹è¯å†å²ï¼ˆè§ä¸Šæ–‡ï¼‰
export function getConversationHistory(node, nodes, edges) { ... }
```

---

## ğŸ”„ æ•°æ®æµ

### 1. æ¶ˆæ¯å‘é€æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥    â”‚
â”‚ å¹¶ç‚¹å‡»å‘é€  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleSendMessage()                     â”‚
â”‚ 1. åˆ›å»º UserInputNode                  â”‚
â”‚ 2. åˆ›å»ºç©ºçš„ LLMResponseNode            â”‚
â”‚ 3. è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ getConversationHistory()                â”‚
â”‚ - ä» LLMResponseNode å‘ä¸Šé€’å½’          â”‚
â”‚ - æ„å»ºå®Œæ•´çš„ç¥–å…ˆé“¾                     â”‚
â”‚ - åŒ…å« parent/children å…³ç³»            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ POST /generate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: server.js                      â”‚
â”‚ 1. æ¥æ”¶å¯¹è¯å†å² JSON                   â”‚
â”‚ 2. æ·»åŠ  System Prompt                  â”‚
â”‚ 3. è°ƒç”¨ OpenAI SDK                     â”‚
â”‚ 4. æµå¼è¿”å›å“åº” (SSE)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Stream chunks
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onChunkReceived()                       â”‚
â”‚ - é€å­—æ›´æ–° LLMResponseNode çš„ text     â”‚
â”‚ - UI å®æ—¶æ˜¾ç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. èŠ‚ç‚¹ç¼–è¾‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒå‡»èŠ‚ç‚¹    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setIsEditing(true)                      â”‚
â”‚ - åˆ‡æ¢åˆ° textarea ç¼–è¾‘æ¨¡å¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ ç”¨æˆ·ç¼–è¾‘æ–‡æœ¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onTextBlur()                            â”‚
â”‚ - æ›´æ–° nodes state                      â”‚
â”‚ - å¦‚æœæ˜¯ UserInputNodeï¼Œè§¦å‘é‡æ–°ç”Ÿæˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ (UserInputNode only)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onRegenerate()                          â”‚
â”‚ - æŸ¥æ‰¾æ‰€æœ‰åä»£ LLM èŠ‚ç‚¹                â”‚
â”‚ - é€ä¸ªé‡æ–°ç”Ÿæˆå“åº”                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. åˆ†æ”¯åˆ›å»ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å³é”®èŠ‚ç‚¹    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸Šä¸‹æ–‡èœå•                              â”‚
â”‚ - Replicate Nodeï¼ˆå¤åˆ¶èŠ‚ç‚¹ï¼‰           â”‚
â”‚ - Create Connected Nodeï¼ˆåˆ›å»ºè¿æ¥èŠ‚ç‚¹ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Replicate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleReplicate()                       â”‚
â”‚ 1. å¤åˆ¶èŠ‚ç‚¹å†…å®¹                        â”‚
â”‚ 2. åœ¨æ—è¾¹åˆ›å»ºæ–°èŠ‚ç‚¹                    â”‚
â”‚ 3. å¤åˆ¶æ‰€æœ‰ä¸Šæ¸¸è¿æ¥                    â”‚
â”‚ â†’ åˆ›å»ºæ–°çš„åˆ†æ”¯èµ·ç‚¹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Create Connected
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleCreateConnectedNode()             â”‚
â”‚ 1. æ ¹æ®å½“å‰èŠ‚ç‚¹ç±»å‹åˆ›å»ºç›¸åç±»å‹        â”‚
â”‚ 2. åœ¨ä¸‹æ–¹åˆ›å»ºæ–°èŠ‚ç‚¹                    â”‚
â”‚ 3. è¿æ¥åˆ°å½“å‰èŠ‚ç‚¹                      â”‚
â”‚ â†’ æ‰©å±•ç°æœ‰åˆ†æ”¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ API è®¾è®¡

### Backend API

**Base URL**: `http://localhost:8000`

#### 1. POST /generate

**æè¿°**: ç”Ÿæˆ LLM å“åº”ï¼ˆæµå¼ï¼‰

**è¯·æ±‚**:
```json
{
  "conversation": [
    {
      "id": "userInput-xxx",
      "role": "user",
      "parent": [],
      "content": "å¦‚ä½•å®ç°ç™»å½•ï¼Ÿ",
      "children": ["llmResponse-yyy"]
    },
    {
      "id": "llmResponse-yyy",
      "role": "assistant",
      "parent": ["userInput-xxx"],
      "content": "",
      "children": []
    }
  ]
}
```

**å“åº”** (Server-Sent Events):
```
data: {"content": "å¯ä»¥"}
data: {"content": "ä½¿ç”¨"}
data: {"content": " JWT"}
...
data: {"content": "[DONE]"}
```

**å®ç°**:
```javascript
app.post("/generate", async (req, res) => {
  const data = req.body;

  res.writeHead(200, {
    'Content-Type': 'text/event-stream',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive'
  });

  const stream = await openai.chat.completions.create({
    model: MODEL_NAME,
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: JSON.stringify(data) }
    ],
    stream: true,
  });

  for await (const chunk of stream) {
    if (chunk.choices[0]?.delta?.content) {
      res.write(`data: ${JSON.stringify({ 
        content: chunk.choices[0].delta.content 
      })}\n\n`);
    }
  }

  res.write(`data: ${JSON.stringify({ content: "[DONE]" })}\n\n`);
  res.end();
});
```

### é…ç½® API

#### ç¯å¢ƒå˜é‡

**æ–‡ä»¶**: `server/.env`

```bash
# å¿…éœ€
OPENAI_API_KEY=sk-your-api-key

# å¯é€‰
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o
```

**æ”¯æŒçš„ API æä¾›å•†**:
- OpenAI (é»˜è®¤)
- Azure OpenAI
- OpenRouter
- æœ¬åœ° LLM (Ollama, LM Studio)

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### Frontend

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|
| React | 18.3.1 | UI æ¡†æ¶ |
| @xyflow/react | 12.0.4 | æµç¨‹å›¾æ¸²æŸ“å’Œäº¤äº’ |
| react-markdown | 9.0.1 | Markdown æ¸²æŸ“ |
| react-syntax-highlighter | 15.5.0 | ä»£ç è¯­æ³•é«˜äº® |
| react-contexify | 6.0.0 | å³é”®èœå• |
| Tailwind CSS | 3.4.7 | æ ·å¼æ¡†æ¶ |

### Backend

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|
| Node.js | 14+ | è¿è¡Œæ—¶ |
| Express | 4.19.2 | Web æ¡†æ¶ |
| OpenAI SDK | 4.54.0 | LLM API å®¢æˆ·ç«¯ |
| dotenv | 16.4.5 | ç¯å¢ƒå˜é‡ç®¡ç† |
| cors | 2.8.5 | è·¨åŸŸæ”¯æŒ |

### å¼€å‘å·¥å…·

| å·¥å…· | ç”¨é€” |
|-----|------|
| concurrently | åŒæ—¶è¿è¡Œå‰åç«¯ |
| nodemon | åç«¯çƒ­é‡è½½ |
| react-scripts | å‰ç«¯æ„å»ºå·¥å…· |

---

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### 1. æ¸²æŸ“ä¼˜åŒ–

```javascript
// ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export default memo(UserInputNode);
export default memo(LLMResponseNode);
```

### 2. æµå¼å“åº”

- **ä¼˜ç‚¹**ï¼šå®æ—¶æ˜¾ç¤º LLM å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **å®ç°**ï¼šServer-Sent Events (SSE)
- **å»¶è¿Ÿ**ï¼šå‡ ä¹æ— å»¶è¿Ÿï¼ˆchunk æ¥æ”¶å³æ˜¾ç¤ºï¼‰

### 3. è™šæ‹Ÿæ»šåŠ¨

- ReactFlow å†…ç½®è™šæ‹ŸåŒ–
- å³ä½¿æœ‰ 1000+ èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½æµç•…è¿è¡Œ

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. API Key ä¿æŠ¤

- âœ… API key å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ `.env`
- âœ… ä¸æš´éœ²ç»™å‰ç«¯
- âœ… `.env` æ–‡ä»¶åœ¨ `.gitignore` ä¸­

### 2. CORS é…ç½®

```javascript
app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true
}));
```

### 3. è¾“å…¥éªŒè¯

**å½“å‰çŠ¶æ€**: âš ï¸ æœªå®ç°
**TODO**: æ·»åŠ è¯·æ±‚éªŒè¯ä¸­é—´ä»¶

---

## ğŸ“ˆ æœªæ¥æ‰©å±•

### 1. æŒä¹…åŒ–å­˜å‚¨

**å½“å‰**: å†…å­˜å­˜å‚¨ï¼ˆåˆ·æ–°ä¸¢å¤±ï¼‰  
**è®¡åˆ’**: IndexedDB æœ¬åœ°å­˜å‚¨

```javascript
// ä¼ªä»£ç 
import Dexie from 'dexie';

const db = new Dexie('GitChatDB');
db.version(1).stores({
  contextTrees: 'id, name, nodes, edges, metadata'
});

// ä¿å­˜
await db.contextTrees.add({
  id: uuid(),
  name: 'é¡¹ç›®è®¨è®º',
  nodes: nodes,
  edges: edges,
  metadata: { createdAt: new Date() }
});
```

### 2. MCP é›†æˆ

è¯¦è§ [ROADMAP.md](../ROADMAP.md)

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **æ— æŒä¹…åŒ–**ï¼šåˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±
2. **æ— åä½œ**ï¼šä»…æ”¯æŒå•ç”¨æˆ·
3. **æ— ç‰ˆæœ¬æ§åˆ¶**ï¼šæ— æ³•å›é€€åˆ°å†å²çŠ¶æ€
4. **å†…å­˜é™åˆ¶**ï¼šè¶…å¤§å¯¹è¯æ ‘ï¼ˆ10000+ èŠ‚ç‚¹ï¼‰å¯èƒ½å¡é¡¿

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ROADMAP.md](../ROADMAP.md) - åŠŸèƒ½è·¯çº¿å›¾
- [README.md](../readme.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [System Prompt](../server/llm-branched-conversation-prompt.md) - LLM æç¤ºè¯

---

**ç»´æŠ¤è€…**: GitChat Team  
**é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/DrustZ/GitChat/issues)

